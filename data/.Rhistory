nrow()
glimpse(order_raw)
order_raw %>%
mutate(billing_phone = str_replace_all(billing_phone, c("[:punct:]"="", " "=""))) %>%
count(billing_email,billing_phone) %>%
group_by(billing_email)%>%  ############# ID TEST
add_count(name="count") %>%
arrange(desc(count)) %>%
glimpse()
order_raw %>%
mutate(billing_phone = str_replace_all(billing_phone, c("[:punct:]"="", " "=""))) %>%
count(billing_email,billing_phone) %>%
group_by(billing_phone)%>%  ############# ID TEST
add_count(name="count") %>%
arrange(desc(count)) %>%
glimpse()
order_raw %>%
mutate(billing_phone = str_replace_all(billing_phone, c("[:punct:]"="", " "=""))) %>%
count(billing_email,billing_phone) %>%
group_by(billing_phone)%>%  ############# ID TEST
add_count(name="count") %>%
arrange(desc(count, billing_phone)) %>%
glimpse()
order_raw %>%
mutate(billing_phone = str_replace_all(billing_phone, c("[:punct:]"="", " "=""))) %>%
count(billing_email,billing_phone) %>%
group_by(billing_phone)%>%  ############# ID TEST
add_count(name="count") %>%
arrange(desc(billing_phone, count)) %>%
glimpse()
order_raw %>%
mutate(billing_phone = str_replace_all(billing_phone, c("[:punct:]"="", " "=""))) %>%
count(billing_email,billing_phone) %>%
group_by(billing_phone)%>%  ############# ID TEST
add_count(name="count") %>%
arrange(desc(count), .by_group = TRUE) %>%
glimpse()
order_raw %>%
distinct(billing_phone) %>%
mutate(billing_phone = str_replace_all(billing_phone, c("[:punct:]"="", " "=""))) %>%
nrow()
order_raw %>%
mutate(billing_phone = str_replace_all(billing_phone, c("[:punct:]"="", " "=""))) %>%
#count(billing_email,billing_phone) %>%
group_by(billing_phone)%>%  ############# ID TEST
add_count(name="count") %>%
arrange(desc(count), .by_group = TRUE) %>%
glimpse()
order_raw %>%
mutate(billing_phone = str_replace_all(billing_phone, c("[:punct:]"="", " "=""))) %>%
count(billing_email,billing_phone) %>%
group_by(billing_phone)%>%  ############# ID TEST
add_count(name="count") %>%
arrange(desc(count), .by_group = TRUE) %>%
glimpse()
order_raw %>%
distinct(billing_email) %>%
nrow()
glimpse(product_main)
glimpse(order_main)
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
glimpse(order_main)
data_files <- list.files()
setwd("C:/Users/sjara/git/made-in-america-yarns/data")
data_files <- list.files()
data_files
df_names <- str_replace(file_list, ".csv", "")
file_list <- list.files()
df_list <- lapply(file_list,
FUN = function(f){
read.csv(f)
})
df_names <- str_replace(file_list, ".csv", "")
df_names
names(df_list) <- df_names
glimpse(df_list)
str(df_list)
View(df_list)
import_data <- function(){
# make a list of the file names in the working directory
file_list <- list.files()
# read all of the files into one list
df_list <- lapply(file_list,
FUN = function(f){
read.csv(f)
})
# name each item in the list using the file name
df_names <- str_replace(file_list, ".csv", "")
names(df_list) <- df_names
return(df_list)
}
data <- import_data()
# extract data frames from list
order <- as.data.frame(data[[order_raw]])
product <- as.data.frame(data[[product_raw]])
order_main <- as.data.frame(data[[order_main]])
product_main <- as.data.frame(data[[product_main]])
order_cols <- as.data.frame(data[[order_cols]])
product_cols <- as.data.frame(data[[product_cols]])
View(data)
# extract data frames from list
order <- as.data.frame(data[order_raw])
# extract data frames from list
order <- as.data.frame(data$order_raw)
glimpse(order)
# import data as a list
data <- import_data()
# extract data frames from list
order <- as.data.frame(data$order_raw)
product <- as.data.frame(data$product_raw)
order_main <- as.data.frame(data$order_main)
product_main <- as.data.frame(data$product_main)
order_cols <- as.data.frame(data$order_cols)
product_cols <- as.data.frame(data$product_cols)
import_data <- function(){
# make a list of the file names in the working directory
file_list <- list.files()
# read all of the files into one list
df_list <- lapply(file_list,
FUN = function(f){
read.csv(f)
})
# name each item in the list using the file name
df_names <- str_replace(file_list, ".csv", "")
names(df_list) <- df_names
return(df_list)
}
# import data as a list
data <- import_data()
# extract data frames from list
order <- as.data.frame(data$order_raw)
product <- as.data.frame(data$product_raw)
order_main <- as.data.frame(data$order_main)
product_main <- as.data.frame(data$product_main)
order_cols <- as.data.frame(data$order_cols)
product_cols <- as.data.frame(data$product_cols)
data$order_cols %>% filter(keep == 1) %>% glimpse()
fields_to_keep <- data$order_cols %>%
filter(keep == 1) %>%
select(variable)
order <- data$order_raw %>%
select(fields_to_keep)
fields_to_keep <- data$product_cols %>%
filter(keep == 1) %>%
select(variable)
product <- data$product_raw %>%
select(fields_to_keep)
fields_to_keep <- data$order_cols %>%
filter(keep == 1) %>%
select(variable)
View(fields_to_keep)
fields_to_keep <- data$order_cols %>%
filter(keep == 1)
order <- data$order_raw %>%
select(fields_to_keep$variable)
fields_to_keep <- data$product_cols %>%
filter(keep == 1)
product <- data$product_raw %>%
select(fields_to_keep$variable)
View(fields_to_keep)
# update matching rows from product_main to match product
# & insert non-matching rows from product to product_main
data$product_main <- rows_upsert(data$product_main,product, by="ID")
# insert non-matching ids from order into order_main
data$order_main <- rows_upsert(data$order_main, order, by="order_id")
check_empty <- function(df){
#checks every column in df for NAs and ""
df <- data.frame("any_nas" = apply(df, 2, function(df) any(is.na(df))),
"any_empty_character_vectors" = apply(df, 2, function(df) any(df == "")))
return(df)
}
check_empty(data$order_main)
View(order_main)
glimpse(data$order_main)
help("case_when")
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1),
customer_id = 1:nrow(data$order_main)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>% glimpse()
#data$order_main <-
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
group_by(billing_email) %>%
mutate(customer_id = 1:nrow(distinct(data$order_main$customer_id))) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>% glimpse()
nrow(distinct(data$order_main$customer_id)))
nrow(distinct(data$order_main$customer_id))
1:nrow(distinct(data$order_main[[customer_id]]))
1:nrow(distinct(data$order_main[customer_id]))
data$order_main %>%
group_by(customer_id) %>%
nrow()
customer_id <- data$order_main %>%
group_by(customer_id) %>%
nrow()
data$order_main %>%
group_by(customer_email) %>%
nrow()
data$order_main %>%
group_by(billing_email) %>%
nrow()
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
group_by(billing_email) %>%
mutate(customer_id = 1:n_customers) %>% glimpse()
n_customers <- data$order_main %>%
group_by(billing_email) %>%
nrow()
#data$order_main <-
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
group_by(billing_email) %>%
mutate(customer_id = 1:n_customers) %>% glimpse()
x2 <- c(3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5)
rank(x2)
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1),
pre_id = 1:nrow(data$order_main)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
group_by(billing_email) %>%
mutate(customer_id = max(pre_id)) %>% glimpse()
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1),
pre_id = 1:nrow(data$order_main)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
group_by(billing_email) %>%
mutate(customer_id = max(pre_id)) %>% arrange(customer_id) %>% glimpse()
data$order_main %>%
ditinct(billing_email) %>%
glimpse()
data$order_main %>%
distinct(billing_email) %>%
glimpse()
data$order_main %>%
distinct(billing_email) %>%
mutate(n=1:575) %>%
glimpse()
data$order_main %>%
distinct(billing_email) %>%
mutate(n=1:3) %>%
glimpse()
data$order_main %>%
distinct(billing_email) %>%
mutate(n=nrow()) %>%
glimpse()
data$order_main %>%
distinct(billing_email) %>%
mutate(n=nrow(.)) %>%
glimpse()
data$order_main %>%
distinct(billing_email) %>%
mutate(n=1:nrow(.)) %>%
glimpse()
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1),
pre_id = 1:nrow(data$order_main)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
group_by(billing_email) %>%
mutate(customer_id = 1:nrow(.)) %>% arrange(customer_id) %>% glimpse()
data$order_main %>%
distinct(billing_email) %>%
mutate(customer_id=1:nrow(.)) %>%
glimpse()
customer_id <- data$order_main %>%
distinct(billing_email) %>%
mutate(customer_id=1:nrow(.)) %>%
glimpse()
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
select(-customer_id) %>%
left_join(customer_id, by=billing_email) %>% glimpse()
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
select(-customer_id) %>%
left_join(customer_id, by="billing_email") %>% glimpse()
customer_id <- data$order_main %>%
distinct(billing_email) %>%
mutate(customer_id=1:nrow(.))
#data$order_main <-
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
select(-customer_id) %>%
left_join(customer_id, by="billing_email") %>% glimpse()
library(dplyr)
library(tidyr)
library(lubridate)
source("C:/Users/sjara/git/made-in-america-yarns/functions.R")
setwd("C:/Users/sjara/git/made-in-america-yarns/data")
# import all data
#--------------------------------------------------------------
data <- import_data()
# filter raw data
#--------------------------------------------------------------
## order
fields_to_keep <- data$order_cols %>%
filter(keep == 1)
order <- data$order_raw %>%
select(fields_to_keep$variable)
## product
fields_to_keep <- data$product_cols %>%
filter(keep == 1)
product <- data$product_raw %>%
select(fields_to_keep$variable)
# update main data with filtered data
#--------------------------------------------------------------
## update matching rows from product_main to match product
## & insert non-matching rows from product to product_main
data$product_main <- rows_upsert(data$product_main,product, by="ID")
## insert non-matching ids from order into order_main
data$order_main <- rows_upsert(data$order_main, order, by="order_id")
customer_id <- data$order_main %>%
distinct(billing_email) %>%
mutate(customer_id=1:nrow(.))
#data$order_main <-
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
select(-customer_id) %>%
left_join(customer_id, by="billing_email") %>% glimpse()
customer_id <- data$order_main %>%
distinct(billing_email) %>%
mutate(id=1:nrow(.))
#data$order_main <-
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
left_join(customer_id, by="billing_email") %>% glimpse()
data$order_main <-
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
left_join(customer_id, by="billing_email")
data$order_main %>% filter(is.na(billing_email) == TRUE)
data$order_main %>% filter(is.na(id) == TRUE) %>% glimpse()
data$order_main %>%
distinct(billing_email) %>%
mutate(id=1:nrow(.)) %>%
filter(billing_email == "henbonfiberwerks@gmail.com")
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
customer_id <- data$order_main %>%
distinct(billing_email) %>%
mutate(id=1:nrow(.))
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
left_join(.,customer_id, by="billing_email") %>% glimpse()
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
left_join(.,customer_id, by="billing_email") %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>% glimpse()
id_df <- data$order_main %>%
distinct(billing_email) %>%
mutate(customer_id=1:nrow(.))
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
check_empty(data$order_main)
check_empty <- function(df){
#checks every column in df for NAs and ""
df <- data.frame("any_nas" = apply(df, 2, function(df) any(is.na(df))),
"any_empty_character_vectors" = apply(df, 2, function(df) any(df == "")))
return(df)
}
check_empty(data$order_main)
id_df <- data$order_main %>%
distinct(billing_email) %>%
mutate(customer_id=1:nrow(.))
data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
select(-customer_id) %>%
left_join(.,id_df, by="billing_email") %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>% glimpse()
data$order_main <- data$order_main %>%
mutate(order_id = as.character(order_id),
order_date = ymd_hms(order$order_date),
order_hour = hour(order_date),
order_date = as_date(ymd_hms(order$order_date)),
returning_customer = case_when(customer_id == 0 ~ 0,
TRUE ~ 1)) %>%
select(-customer_id) %>%
left_join(.,id_df, by="billing_email") %>%
mutate_if(is.character, list(~na_if(tolower(.),"")))
check_empty(data$order_main)
is.na(NA)
is.na()
is.na(NaN)
is.na("")
check_empty <- function(df){
#checks every column in df for NAs and ""
df <- data.frame("any_nas" = apply(df, 2, function(df) any(is.na(df))),
"any_empty_character_vectors" = apply(df, 2, function(df) any(df == "", na.rm = TRUE)))
return(df)
}
check_empty(data$order_main)
glimpse(data$order_main)
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
id_df <- data$order_main %>%
distinct(billing_email) %>%
mutate(customer_id=1:nrow(.))
data$order_main <- data$order_main %>%
select(-customer_id) %>%
left_join(.,id_df, by="billing_email") %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
filter(shipping_country == "us")
glimpse(data$order_main)
data$order_main <- data$order_main %>%
select(-customer_id) %>%
left_join(.,id_df, by="billing_email") %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
filter(shipping_country == "us") %>%
select(-shipping_country)
glimpse(data$order_main)
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
id_df <- data$order_main %>%
distinct(billing_email) %>%
mutate(customer_id=1:nrow(.))
data$order_main <- data$order_main %>%
select(-customer_id) %>%
left_join(.,id_df, by="billing_email") %>%
mutate_if(is.character, list(~na_if(tolower(.),""))) %>%
filter(shipping_country == "us") %>%
select(-shipping_country)
glimpse(data$order_main)
check_empty(data$order_main)
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
glimpse(data$order_main)
glimpse(data$product_main)
data$product_main %>% filter(ID == 19107)
data$product_main %>% filter(ID == 13654)
