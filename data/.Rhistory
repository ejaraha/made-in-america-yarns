order <- read.csv("C:\Users\sjara\Downloads\wc_order.csv")
order <- read.csv("C:/Users/sjara/Downloads/wc_order.csv")
glimpse(order)
head(order)
install.packages(tidyverse)
install.packages("tidyverse")
glimpse(order)
library(dplyr)
glimpse(order)
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
data$product_main %>% glimpse()
data$product_main %>%
mutate("comma_count" = str_count(categories)) %>% glimpse()
data$product_main %>%
mutate("comma_count" = str_count(categories, ",")) %>% glimpse()
data$product_main %>%
mutate("comma_count" = str_count(categories, ",")) %>% arrange(comma_count) %>% glimpse()
data$product_main %>%
mutate("comma_count" = str_count(categories, ",")) %>% arrange(desc(comma_count)) %>% glimpse()
lapply(1:10, paste("cat", sep="_"))
test <- list(1:10)
test
lapply(test, paste("cat", sep="_"))
lapply(test, FUN = paste("cat", sep="_"))
paste(test, "cat", sep="_")
modify(test, paste("cat", sep="_"))
modify(test, as.character)
test <- modify(test, as.character)
modify(test, paste("f"))
modify(test, toupper)
paste(test)
paste(test, sep="-")
paste("category", test, sep="_")
test
test_ <- c("a","b")
paste("category", test_, sep="_")
class(test_)
class)test
class(test)
as.character(test)
paste(1:10, "category", sep="_")
paste("category", 1:10, sep="_")
category_columns <- paste("category", 1:10, sep="_")
category_columns <- paste("category", 1:10, sep="_")
product_category <- data$product_main %>%
separate(categories, into = category_columns, sep = ",")
category_columns <- paste("category", 1:10, sep="_")
product_category <- data$product_main %>%
separate(categories, into = category_columns, sep = ",", fill="right")
glimpse(product_category)
data$product_main %>% glimpse()
data$product_main %>% filter(id=22322)
data$product_main %>% filter(id==22322)
data$product_main %>%
mutate("fiber" = str_extract_all(categories, "(?<=fiber > ).*(?=,)")) %>% glimpse()
data$product_main %>%
mutate("fiber" = str_extract_all(categories, "(?<=fiber > ).*(?=, )")) %>% glimpse()
test<- "big cones, fiber > cotton, yarn weight > lace, made in usa, fiber > rayon / viscose, yarn weight > undefined weight, fiber > yarn for indie dyers"
str_extract_all(test, "(?<=fiber > ).*(?=, )")
data$product_main %>% filter(id==22322)
data$product_main %>% filter(id==22323)
str_extract_all(test, "(?<=fiber > ).*(?=, )")
test <- "big cones, made in usa, fiber > rayon / viscose, yarn weight > worsted, fiber > yarn for indie dyers"
str_extract_all(test, "(?<=fiber > ).*(?=, )")
test
str_extract_all(test, "(?<=fiber > )[^,]*(?=, )")
str_extract_all(test, "b")
str_extract_all(test, "(?<=fiber > )[^,]*")
data$product_main %>%
mutate("fiber" = str_extract_all(categories, "(?<=fiber > )[^,]*")) %>% glimpse()
data$product_main %>%
mutate("fiber" = str_extract_all(categories, "(?<=fiber > )[^,]*"),
"yarn_weight" = str_extract_all(categories, "(?<=yarn weight > )[^,]*"))%>% glimpse()
data$product_main %>%
mutate("fiber" = str_extract_all(categories, "(?<=fiber > )[^,]*"),
"yarn_weight" = str_extract_all(categories, "(?<=yarn weight > )[^,]*"),
"big_cones" = str_detect(categories, "big cones"))%>% glimpse()
data$product_main %>%
mutate("fiber" = str_extract_all(categories, "(?<=fiber > )[^,]*"),
"yarn_weight" = str_extract_all(categories, "(?<=yarn weight > )[^,]*"),
"big_cones" = str_detect(categories, "big cones"),
"spools" = str_detect(categories, "spools"))%>% glimpse()
product_category <- data$product_main %>%
mutate("fiber" = str_extract_all(categories, "(?<=fiber > )[^,]*"),
"yarn_weight" = str_extract_all(categories, "(?<=yarn weight > )[^,]*"),
"effect" = str_extract_all(categories, "(?<=effect > )[^,]*"),
"hue" = str_extract_all(categories, "(?<=hue > )[^,]*"),
"big_cones" = str_detect(categories, "big cones"),
"spools" = str_detect(categories, "spools"))
glimpse(product_category)
data$product_main %>%
select(product_id,
fiber) %>% unnest(fiber) %>% glimpse()
data$product_main %>%
select(id,#product_id,
fiber) %>% unnest(fiber) %>% glimpse()
product_category %>%
select(id,#product_id,
fiber) %>% unnest(fiber) %>% glimpse()
glimpse(product_category)
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
product_category <- data$product_main %>%
mutate("fiber" = str_extract_all(categories, "(?<=fiber > )[^,]*"),
"yarn_weight" = str_extract_all(categories, "(?<=yarn weight > )[^,]*"),
"effect" = str_extract_all(categories, "(?<=effect > )[^,]*"),
"hue" = str_extract_all(categories, "(?<=hue > )[^,]*"),
"big_cones" = str_detect(categories, "big cones"),
"spools" = str_detect(categories, "spools"))
glimpse(product_category)
product_category %>%
filter(type == "variable") %>%
rename("product_id"=id) %>%
unnest(fiber) %>%
select(product_id,
fiber) %>% glimpse()
product_fiber <- product_category %>%
filter(type == "variable") %>%
rename("product_id"=id) %>%
unnest(fiber) %>%
select(product_id,
fiber)
product_category %>%
filter(type == "variable") %>%
rename("product_id"=id) %>%
unnest(yarn_weight) %>%
select(product_id,
yarn_weight)
product_category %>%
filter(type == "variable") %>%
rename("product_id"=id) %>%
unnest(yarn_weight) %>%
select(product_id,
yarn_weight) %>% glimpse()
product_yarn_weight <- product_category %>%
filter(type == "variable") %>%
rename("product_id"=id) %>%
unnest(yarn_weight) %>%
select(product_id,
yarn_weight)
glimpse(data$product_main)
order_main_pivot <- data$order_main %>%
# gather all "line_item_" columns
pivot_longer(cols = starts_with("line_item"),
names_to = "item",
values_to = "item_description",
values_drop_na = TRUE) %>%
# extract product info from item_description
mutate("product_id" = str_extract(item_description, "(?<=product_id:)[:digit:]*"),
"variation_id" = str_extract(item_description, "(?<=variation_id:)[:digit:]*"),
"quantity" = str_extract(item_description, "(?<=quantity:)[:digit:]*(?=|total)"),
"name" = str_sub(str_trim(str_extract(item_description, "(?<=name:).*(?=product_id:)")),start=1, end=-2),
"color" = str_extract(item_description, "(?<=color:|colors:)[:alpha:]*[:space:]*[:alpha:]*[:space:]*[:alpha:]*")) %>%
separate(name, into = c("name", "detail"), sep = "-", extra="merge", fill="right") %>%
mutate_at(c("name", "detail"), str_trim)
# handle error
order_main_pivot <- order_main_pivot %>%
# this is to handle an error in some of the entries of order_raw$line_item_
# when product_id="0" & variation_id!=NA, then swap product_id and variation_id
mutate(product_id = case_when(product_id == "0" & is.na(variation_id) == FALSE ~variation_id,
TRUE ~ as.character(product_id)),
variation_id = case_when(product_id == variation_id ~"0",
TRUE ~ as.character(variation_id)))
glimpse(order_main_pivot)
order_main_pivot %>%
group_by(product_id, meta.yarn_usage) %>%
distinct() %>%
select(product_id,
meta.yarn_usage)%>% glimpse()
order_main_pivot %>%
#group_by(product_id, meta.yarn_usage) %>%
distinct(product_id, meta.yarn_usage) %>%
select(product_id,
meta.yarn_usage)%>% glimpse()
data$order_main %>%
distinct(customer_id,
billing_email,
user_id) %>% glimpse()
data$order_main %>%
distinct(customer_id,
meta.yarn_usage) %>% glimpse()
glimpse(data$role_main)
data$order_main %>%
filter(user.email == "adamaronowitz@gmail.com")%>%
distinct(customer_id,
meta.yarn_usage)
data$order_main %>%
filter(user.email == "adamaronowitz@gmail.com")%>%
data$role_main %>%
filter(user.email == "adamaronowitz@gmail.com")
data$role_main %>%
filter(user.email == "adamaronowitz@gmail.com")
