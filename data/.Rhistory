source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
data$role_raw_drop %>% glimpse()
# create role df
# make a list of lists to unpack users with multiple roles
role_list <- strsplit(df_list$role_main[["wp.capabilities"]],":true") %>%
# remove anything that isn't a letter
lapply(.,FUN = function(x){str_replace_all(x,"[^a-z]", "")})
# create a data frame with space for a user_id for each role
role_df <- data.frame("user_id" = rep(df_list$role_main[["id"]], sapply(role_list, length)),
"role" = unlist(role_list)) %>%
mutate(across(.cols = contains("_id"), as.character)) %>%
# then filter to isolate wholesale buyers
filter(role == "ignite_level_wholesale_buyer")
# create role df
# make a list of lists to unpack users with multiple roles
role_list <- strsplit(data$role_main[["wp.capabilities"]],":true") %>%
# remove anything that isn't a letter
lapply(.,FUN = function(x){str_replace_all(x,"[^a-z]", "")})
# create a data frame with space for a user_id for each role
role_df <- data.frame("user_id" = rep(data$role_main[["id"]], sapply(role_list, length)),
"role" = unlist(role_list)) %>%
mutate(across(.cols = contains("_id"), as.character)) %>%
# then filter to isolate wholesale buyers
filter(role == "ignite_level_wholesale_buyer")
View(role_list)
# create role df
# make a list of lists to unpack users with multiple roles
role_list <- strsplit(data$role_main[["wp.capabilities"]],":true") %>%
# remove anything that isn't a letter
lapply(.,FUN = function(x){str_replace_all(x,"[^a-z]", "")})
# create a data frame with space for a user_id for each role
role_df <- data.frame("user_id" = rep(data$role_main[["id"]], sapply(role_list, length)),
"role" = unlist(role_list)) %>%
mutate(across(.cols = contains("_id"), as.character)) %>%
# then filter to isolate wholesale buyers
filter(role == "ignitelevelwholesalebuyer")
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
# create role df
# make a list of lists to unpack users with multiple roles
role_list <- strsplit(data$role_main[["wp.capabilities"]],":true") %>%
# remove anything that isn't a letter
lapply(.,FUN = function(x){str_replace_all(x,"[^a-z]", "")})
# create a data frame with space for a user_id for each role
role_df <- data.frame("user_id" = rep(data$role_main[["id"]], sapply(role_list, length)),
"role" = unlist(role_list)) %>%
mutate(across(.cols = contains("_id"), as.character)) %>%
# then filter to isolate wholesale buyers
filter(role == "ignitelevelwholesalebuyer")
View(role_df)
data$role_main %>% glimpse()
data$role_raw %>% glimpse()
data$role_main %>% inner_join(role_df, by = c("id"="user_id") %>% glimpse()
data$role_main %>% inner_join(role_df, by = c("id"="user_id")) %>% glimpse()
data$role_main %>% inner_join(role_df, by = c("id=user_id")) %>% glimpse()
data$role_main %>% inner_join(role_df, by = c("id"="user_id")) %>% glimpse()
glimpse(data$role_main)
glimpse(role_df)
data$role_main %>%
mutate(id = as.character(id)) %>%
inner_join(role_df, by = c("id"="user_id")) %>% glimpse()
data$role_main %>%
mutate(id = as.character(id)) %>%
inner_join(role_df, by = c("id"="user_id")) %>%
select(user.email) %>%
glimpse()
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
# export denormalized tables
#-------------------------------------------------------------
export_data(data_norm, data_denorm, data, wholesale_emails)
names(data_norm)
# get wholesale emails for mailchimp
#-------------------------------------------------------------
wholesale_emails <- get_wholesale_emails()
get_wholesale_emails <- function(role_df, email_df){
# this df contains user_ids of wholesale buyers
wholesale_df <- data_norm$wholesale_df
# this df contains emails and user_ids of all users
email_df <- data$role_main
# do an inner join to get emails of only wholesale buyers
wholesale_emails <- email_df %>%
mutate(id = as.character(id)) %>%
inner_join(wholesale_df, by = c("id"="user_id")) %>%
select(user.email)
# return list of wholesaler emails
return(wholesale_emails)
}
# get wholesale emails for mailchimp
#-------------------------------------------------------------
wholesale_emails <- get_wholesale_emails()
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
