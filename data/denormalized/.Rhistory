order <- read.csv("C:\Users\sjara\Downloads\wc_order.csv")
order <- read.csv("C:/Users/sjara/Downloads/wc_order.csv")
glimpse(order)
head(order)
install.packages(tidyverse)
install.packages("tidyverse")
glimpse(order)
library(dplyr)
glimpse(order)
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
View(data_norm)
data_denorm <- list()
# join product data frames
data_denorm$product <- data$product %>%
left_join(data$product_hue, by=c("product_id"="product_id", "variation_id"="variation_id")) %>%
left_join(data$product_fiber, by="product_id") %>%
left_join(data$product_yarn_weight, by="product_id") %>%
left_join(data$product_effect, by="product_id")
View(data)
data_denorm$product <- data$product %>%
left_join(data$product_hue, by=c("product_id"="product_id", "variation_id"="variation_id")) %>%
left_join(data$product_fiber, by="product_id")
data_denorm$product <- data$product %>%
left_join(data$product_hue, by=c("product_id"="product_id", "variation_id"="variation_id")) %>%
left_join(data$product_fiber, by="product_id")
data_denorm$product <- data$product %>%
left_join(data$product_hue, by=c("product_id"="product_id", "variation_id"="variation_id"))
glimpse(data$product_hue)
glimpse(data$product)
View(data)
glimpse(data_norm$product)
glimpse(data_norm$product_hue)
data_denorm$product <- data_norm$product %>%
left_join(data_norm$product_hue, by=c("product_id"="product_id", "variation_id"="variation_id")) %>%
left_join(data_norm$product_fiber, by="product_id") %>%
left_join(data_norm$product_yarn_weight, by="product_id") %>%
left_join(data_norm$product_effect, by="product_id")
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename("name"=name.x,
"color"=color.x)%>%
select(-c(name.y, color.y))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm, by=c("product_id"="product_id", "variation_id"="variation_id"))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id")
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id")
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id")
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm, by=c("product_id"="product_id", "variation_id"="variation_id"))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename("name"=name.x,
"color"=color.x)%>%
select(-c(name.y, color.y))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id"))
glimpse(data_denorm$order)
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename("name"=name.x,
"color"=color.x)
help(rename)
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename(name=name.x,
color=color.x)%>%
select(-c(name.y, color.y))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename(name="name.x",
color="color.x")%>%
select(-c(name.y, color.y))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename(name.x=name,
color.x=color)%>%
select(-c(name.y, color.y))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename(name=name.x,
color=color.x)
names(data_denorm$order)
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename(name=name.x,
color=color.x)%>%
select(-c(name.y, color.y))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename(name=name.x)%>%
select(-c(name.y, color.y))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename(.,name=name.x)%>%
select(-c(name.y, color.y))
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %%
rename(name="name.x")
data_denorm$order <- data_norm$order %>%
left_join(data_norm$order_product, by="order_id") %>%
left_join(data_norm$order_coupon, by="order_id") %>%
left_join(data_norm$order_usage, by="order_id") %>%
left_join(data_denorm$product, by=c("product_id"="product_id", "variation_id"="variation_id")) %>%
rename(name=name.x)
data_denorm <- denormalize(data_norm)
source('C:/Users/sjara/git/made-in-america-yarns/update_db.r', echo=TRUE)
library(ggplot2)
library(plotly)
setwd("C:/Users/sjara/git/made-in-america-yarns/data/denormalized")
source("C:/Users/sjara/git/made-in-america-yarns/functions.R")
order <- read.csv("order.csv", stringsAsFactors=FALSE)
product <- read.csv("product.csv", stringsAsFactors = FALSE)
order <- order %>%
mutate("order_ym" = format(as.Date(order_date), "%Y-%m"),
"order_y" = year(as.Date(order_date)),
"order_m" = month(as.Date(order_date)))
order <- order %>% left_join(product, by=c("product_id"="product_id", "variation_id"="variation_id")) %>%
rename("name"=name.x,
"color"=color.x)%>%
select(-c(name.y, color.y))
p<-
order %>%
group_by(order_ym, user_type, product_id) %>%
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>%
distinct(product_id, name, hover.a, hover.b) %>%
ungroup() %>%
group_by(order_ym, user_type, product_id) %>%
nest() %>%
ggplot(aes(fill=user_type, x=order_ym, y=n, text=data)) +
geom_col(position="stack")
ggplotly(p)
order %>%
group_by(order_ym, user_type, product_id) %>%
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>%
distinct(product_id, name, hover.a, hover.b) %>%
ungroup() %>%
group_by(order_ym, user_type, product_id) %>%
nest() %>% glimpse()
order %>%
group_by(order_ym, user_type, product_id) %>%
# number of orders for each product_id/user_type/order_ym combo
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
# find top three products by user_type/order_ym
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>%
distinct(order_ym, user_type) %>% glimpse()
order %>%
group_by(order_ym, user_type, product_id) %>%
# number of orders for each product_id/user_type/order_ym combo
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
# find top three products by user_type/order_ym
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>% glimpse()
order %>%
group_by(order_ym, user_type, product_id) %>%
# number of orders for each product_id/user_type/order_ym combo
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
# find top three products by user_type/order_ym
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>%
nest() %>% glimpse()
order %>%
group_by(order_ym, user_type, product_id) %>%
# number of orders for each product_id/user_type/order_ym combo
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
# find top three products by user_type/order_ym
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>%
distinct(product_id, name, user_type, order_ym) %>% glimpse()
order %>%
group_by(order_ym, user_type, product_id) %>%
# number of orders for each product_id/user_type/order_ym combo
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
# find top three products by user_type/order_ym
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>%
distinct(product_id, name, user_type, order_ym) %>%
select(-product_id) %>%
nest() %>% glimpse()
p<-
order %>%
group_by(order_ym, user_type, product_id) %>%
# number of orders for each product_id/user_type/order_ym combo
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
# find top three products by user_type/order_ym
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>%
distinct(product_id, name, user_type, order_ym) %>%
select(-product_id) %>%
nest()
View(p)
View(p[[3]][[1]])
View(p[[3]][[2]])
View(p[[3]][[4]])
View(p)
top_products_by_ym_user <- order %>%
group_by(order_ym, user_type, product_id) %>%
# number of orders for each product_id/user_type/order_ym combo
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
# find top three products by user_type/order_ym
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>%
distinct(product_id, name, user_type, order_ym) %>%
select(-product_id) %>%
nest()
View(top_products_by_ym_user)
order %>%
group_by(order_ym, user_type) %>%
summarize(n_orders=n()) %>% glimpse()
orders_by_ym_user <- order %>%
group_by(order_ym, user_type) %>%
summarize(n_orders=n())
View(order)
View(orders_by_ym_user)
orders_by_ym_user %>%
left_join(top_products_by_ym_user, by=c("user_type"="user_type", "order-ym"="order_ym")) %>% glimpse()
orders_by_ym_user %>%
left_join(top_products_by_ym_user, by=c("user_type"="user_type", "order_ym"="order_ym")) %>% glimpse()
p <- orders_by_ym_user %>%
left_join(top_products_by_ym_user, by=c("user_type"="user_type", "order_ym"="order_ym")) %>%
ggplot(aes(fill=user_type, x=order_ym, y=n_orders, text=data)) +
geom_col(position="stack")
ggplotly(p)
order %>%
# number of orders for each user_type/order_ym combo
group_by(order_ym, user_type) %>% glimpse()
order %>%
distinct(order_id, order_ym, user_type) %>%
# number of orders for each user_type/order_ym combo
group_by(order_ym, user_type) %>% glimpse()
order %>%
distinct(order_id, order_ym, user_type) %>%
# number of orders for each user_type/order_ym combo
group_by(order_ym, user_type) %>%
summarize(n_orders=n(), .groups = "keep")
top_products_by_ym_user <- order %>%
group_by(order_ym, user_type, product_id) %>%
# number of orders for each product_id/user_type/order_ym combo
mutate("hover.a" = n()) %>%
ungroup() %>%
group_by(order_ym, user_type) %>%
# find top three products by user_type/order_ym
mutate("hover.b" = dense_rank(desc(hover.a))) %>%
filter(hover.b %in% c(1,2,3)) %>%
distinct(product_id, name, user_type, order_ym) %>%
select(-product_id) %>%
nest()
orders_by_ym_user <- order %>%
# number of orders for each user_type/order_ym combo
distinct(order_id, order_ym, user_type) %>%
group_by(order_ym, user_type) %>%
summarize(n_orders=n(), .groups = "keep")
p <- orders_by_ym_user %>%
left_join(top_products_by_ym_user, by=c("user_type"="user_type", "order_ym"="order_ym")) %>%
ggplot(aes(fill=user_type, x=order_ym, y=n_orders, text=data)) +
geom_col(position="stack")
ggplotly(p)
